.\" Automatically generated by Pandoc 3.1.4
.\"
.\" Define V font for inline verbatim, using C font in formats
.\" that render this, and otherwise B font.
.ie "\f[CB]x\f[]"x" \{\
. ftr V B
. ftr VI BI
. ftr VB B
. ftr VBI BI
.\}
.el \{\
. ftr V CR
. ftr VI CI
. ftr VB CB
. ftr VBI CBI
.\}
.TH "rdmutil" "1" "2023-08-07" "irdmtools user manual" "version 0.0.31 08a4023"
.hy
.SH NAME
.PP
rdmutil
.SH SYNOPSIS
.PP
rdmutil OPTIONS ACTION [ACTION_PARAMETERS \&...]
.SH DESCRIPTION
.PP
\f[B]rdmutil\f[R] provides a quick wrapper around Invenio-RDM\[cq]s
OAI-PMH and REST API.
By default rdmutil looks for three environment variables.
.TP
RDM_URL
the URL of the Invenio RDM API and OAI-PMH services
.TP
RDMTOK
the token needed to access the Invenio RDM API and OAI-PMH services
.TP
RDM_C_NAME
A dataset collection name.
Collection must exist.
See \f[V]dataset help init\f[R]
.PP
The environment provides the default values for configuration.
They maybe overwritten by using a JSON configuration file.
The corresponding attributes are \[lq]invenio_api\[rq],
\[lq]invenio_token\[rq] and \[lq]c_name\[rq].
.PP
rdmutil uses the OAI-PMH service to retrieve record ids.
This maybe slow due to rate limits.
Also provided is a query service and record retrieval using Invenio
RDM\[cq]s REST API.
These are faster but the query services limited the total number of
results to 10K records.
.SH OPTIONS
.TP
help
display help
.TP
license
display license
.TP
version
display version
.TP
config
provide a path to an alternate configuration file
(e.g.\ \[lq]rdmtools.json\[rq])
.SH ACTION
.PP
\f[B]rdmutil\f[R] supports the following actions.
.TP
setup
Display an example JSON setup configuration file, if it already exists
then it will display the current configuration file.
No optional or required parameters.
When displaying the JSON configuration a placeholder will be used for
the token value.
.TP
get_modified_ids START [END]
Returns a list of modified record ids (created, updated, deleted) in the
time range listed.
This method uses OAI-PMH for id retrieval.
It is rate limited.
Start and end dates are inclusive and should be specific in YYYY-MM-DD
format.
.TP
get_all_ids
Returns a list of all repository record ids.
The method uses OAI-PMH for id retrieval.
It is rate limited and will take come time to return all record ids.
A test instance took 11 minutes to retrieve 24000 record ids.
.TP
query QUERY_STRING [size | size sort]
Returns a result using RDM\[cq]s search engine.
It is limited to about 10K total results.
You can use the see RDM\[cq]s documentation for query construction.
See <https://inveniordm.docs.cern.ch/customize/search/>,
<https://inveniordm.docs.cern.ch/reference/rest_api_requests/> and
https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-syntax.
Query takes one required parameter and two option.
.TP
get_record RECORD_ID
Returns a specific simplified record indicated by RECORD_ID,
e.g.\ bq3se-47g50.
The REORCID_ID is a required parameter.
.TP
get_raw_record RECORD_ID
Returns a specific map/dictionary record indicated by RECORD_ID,
e.g.\ bq3se-47g50.
The REORCID_ID is a required parameter.
.TP
get_files RECORD_ID
Return a list of files for record with RECORD_ID.
RECORD_ID is required.
.TP
get_file RECORD_ID FILENAME
Returns the metadata for a file indicated by RECORD_ID and FILENAME,
e.g.\ bq3se-47g50 is a record id and article.pdf is a filename.
RECORD_ID and FILENAME are required parameters.
.TP
retrieve_file RECORD_ID FILENAME [OUTPUT_FILENAME]
Retrieves the file indicated by RECORD_ID and FILENAME,
e.g.\ bq3se-47g50 is a record id and article.pdf is a filename.
RECORD_ID and FILENAME are required parameters.
OUTPUT_FILENAME is optional, if present then the file will be save to
this name on the file system.
.TP
get_versions
Retrieve metadata about versions for RECORD_ID.
RECORD_ID is required.
.TP
get_latest_version
Retreive the latest version metadata for a RECORD_ID.
RECORD_ID is requireed.
.TP
new_record [FILENAME]
Create a new record from JSON source.
If FILENAME is set then json source is read from FILENAME otherwise it
reads from standard input.
.TP
new_version RECORD_ID
This will create a new version of the record.
RECORD_ID is required.
.TP
new_draft RECORD_ID
Create a new draft for an existing record.
RECORD_ID is required.
.TP
get_draft RECORD_ID
Retrieve an existing draft record for RECORD_ID.
RECORD_ID is required.
If draft of RECORD_ID does not exist you will see a 404 error.
.TP
update_draft RECORD_ID [FILENAME]
Update a draft record.
RECORD_ID is required.
FILENAME is optional, if one is provided the JSON document is used to
update RDM, otherwise standard input is used to get the JSON required to
do the update.
.TP
set_files_enable RECORD_ID true|false
This will flip the files.enabled value to true and update the draft.
RECORD_ID is required.
The one of the values true or false are required.
.TP
upload_files RECORD_ID FILENAME [FILENAME \&...]
Upload files to a draft record.
RECORD_ID is required as are one or more filenames.
.TP
get_files RECORD_ID
Retrieve the list of files attached to a draft.
RECORD_ID is required.
.TP
delete_files RECORD_ID FILENAME [FILENAME \&...]
Delete files in a draft record.
RECORD_ID is required as are one or more filenames.
.TP
discard_draft
Discard (delete) a draft record from RDM.
RECORD_ID is required.
.TP
review_comment RECORD_ID [FILENAME]
Submit a comment to a review.
RECORD_ID is required.
If FILENAME is provided the comment is read from a file otherwise it is
read from standard input.
.TP
send_to_community RECORD_ID COMMUNITY_ID
Submit a draft record to a community for review.
RECORD_ID and COMMUMITY_ID are required.
.TP
get_review
Get review requests assocaited with RECORD_ID.
RECORD_ID is required.
.TP
review_request RECORD_ID accept|decline|cancel|\[lq]\[rq] [COMMENT]
Review a submitted draft record.
the values \[lq]accept\[rq], \[lq]decline\[rq] or \[lq]\[rq] and an
optional COMMENT.
.TP
get_access RECORD_ID [ACCESS_TYPE]
This will return the JSON for the access attribute in the record.
If you include ACCESS_TYPE of \[lq]files\[rq] or \[lq]records\[rq] it
will return just that attribute.
RECORD_ID is always required.
.TP
set_access RECORD_ID ACCESS_TYPE ACCESS_VALUE
This will update a record with metadata access to the record.
RECORD ID is required.
ACCESS_TYPE is required and can be either \[lq]record\[rq] or
\[lq]files\[rq].
ACCESS_VALUE is required and can be \[lq]restricted\[rq] or
\[lq]public\[rq].
.TP
harvest KEY_JSON
harvest takes a JSON file containing a list of keys and harvests each
record into the dataset collection.
.TP
get_endpoint PATH
Perform a GET to the end point indicated by PATH.
PATH is required.
.TP
post_endpoint PATH [FILENAME]
Perform a POST to the end point indicated by PATH.
PATH is required.
If FILENAME is provided then JSON source is read file the file otherwise
it is read from standard input.
.TP
put_endpoint PATH [FILENAME]
Perform a PUT to the end point indicated by PATH.
PATH is required.
If FILENAME is provided then JSON source is read file the file otherwise
it is read from standard input.
.TP
patch_endpoint PATH [FILENAME]
Perform a PATCH to the end point indicated by PATH.
PATH is required.
If FILENAME is provided then JSON source is read file the file otherwise
it is read from standard input.
.SH ACTION_PARAMETERS
.PP
Action parameters are the specific optional or required parameters need
to complete an aciton.
.SH EXAMPLES
.PP
Setup for \f[B]rdmutil\f[R] by writing an example JSON configuration
file.
\[lq]nano\[rq] is an example text editor program, you need to edit the
sample configuration appropriately.
.IP
.nf
\f[C]
rdmutil setup >rdmtools.json
nano rdmtools.json
\f[R]
.fi
.PP
Get a list of Invenio-RDM record ids modified from Jan 1, 2023 to Jan
31, 2023.
.IP
.nf
\f[C]
rdmutil get_modified_ids 2023-01-01 2023-01-31
\f[R]
.fi
.PP
Get a list of all Invenio-RDM record ids.
.IP
.nf
\f[C]
rdmutil get_all_ids
\f[R]
.fi
.PP
Get a specific Invenio-RDM record.
Record is validated against irdmtool model.
.IP
.nf
\f[C]
rdmutil get_record bq3se-47g50
\f[R]
.fi
.PP
Get a specific Invenio-RDM record as it is returned by the RDM API.
.IP
.nf
\f[C]
rdmutil get_raw_record bq3se-47g50
\f[R]
.fi
.SH AUTHORS
R. S. Doiel and Tom Morrell.
